#include "delay.h"
# include "e18.h"
#include "pwm.h"
#include "sys.h"	

int main(void)
{	
	unsigned char i;
	delay_init();	    	   
	 motorInit();
	E18_Init();
	 TIM1_PWM_Init(65535,0);
	 DJ_1(1);
			DJ_2(1);
	delay_ms(1000);
	
	
/*  
			第
				一
					部
						分
		11.48V
	
*/
	while(1)
	{
		if(KEY1==0)
		{
			delay_ms(10);
			if(KEY1==0)
			{
				i=1;
				while(KEY1==0);
				delay_ms(200);
				break;
			}
		}
		if(KEY2==0)
		{
			delay_ms(10);
			if(KEY2==0)
			{
				i=2;
				while(KEY2==0);
				delay_ms(200);
				break;
			}
		}
	}
	 while(1)//开始时贴边走
	 {
		 if(G12 ==0 && G13!=0)//直走
		 {
			 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 }
		 if(G12!=0 && G13!=0)//向右修正
		 {
		 		TIM_SetCompare1(TIM1,15000);//右轮
	    TIM_SetCompare2(TIM1,33000);//左轮
		 }
		  if(G12==0 && G13==0)//想左修正
		 {
				TIM_SetCompare1(TIM1,32000);//右轮
	    TIM_SetCompare2(TIM1,15000);//左轮
		 }
		 if(G15==0)
			 break;
	 }
	 while(1)//拐第一个弯道
	 {
		 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 delay_ms(230);
		 TIM_SetCompare1(TIM1,32000);//右轮
	    TIM_SetCompare2(TIM1,0);//左轮
		 delay_ms(490);
		 break;
	 }
	 	 while(1)
	 {
		 if(G12 ==0 && G13!=0)//直走
		 {
			 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 }
		 if(G12!=0 && G13!=0)//向右修正
		 {
		 		TIM_SetCompare1(TIM1,15000);//右轮
	    TIM_SetCompare2(TIM1,33000);//左轮
		 }
		  if(G12==0 && G13==0)//想左修正
		 {
				TIM_SetCompare1(TIM1,32000);//右轮
	    TIM_SetCompare2(TIM1,15000);//左轮
		 }
		 if(G14==0)
			 break;
	 }
	 while(1)    //过第二个障碍物
	 {
		 //右拐
		 TIM_SetCompare1(TIM1,0);//右轮
	   TIM_SetCompare2(TIM1,40000);//左轮
		 delay_ms(450);
		 //直走
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 delay_ms(190);
		 //左拐
		 TIM_SetCompare1(TIM1,40000);//右轮
	   TIM_SetCompare2(TIM1,0);//左轮
		 delay_ms(400);
		 //直走
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 delay_ms(700);
		 //左拐
		 TIM_SetCompare1(TIM1,40000);//右轮
	   TIM_SetCompare2(TIM1,0);//左轮
		 delay_ms(290);
		 break;
	 }
	 while(1)/////直走
	 {
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 if(G6!=0)
		   break;
	 }
	 while(1)//右转
	 {
		 TIM_SetCompare1(TIM1,0);//右轮
	   TIM_SetCompare2(TIM1,25000);//左轮
		 if(G13!=0)
		 break;
	 }
	 while(1)
	 {
		 TIM_SetCompare1(TIM1,0);//右轮
	   TIM_SetCompare2(TIM1,25000);//左轮
		 if(G13==0)
			 break;
	 }
	 while(1)
	 {
		 if(G12 ==0 && G13!=0)//直走
		 {
			 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 }
		 if(G12!=0 && G13!=0)//向右修正
		 {
		 		TIM_SetCompare1(TIM1,15000);//右轮
	    TIM_SetCompare2(TIM1,33000);//左轮
		 }
		  if(G12==0 && G13==0)//想左修正
		 {
				TIM_SetCompare1(TIM1,32000);//右轮
	    TIM_SetCompare2(TIM1,15000);//左轮
		 }
		 if(G15==0)
			 break;
	 }
	 if(i==1)
{
	  while(1)    //过第二个弯道第一处障碍物
	 {
		//右拐
		 TIM_SetCompare1(TIM1,0);//右轮
	   TIM_SetCompare2(TIM1,40000);//左轮
		 delay_ms(200);
		 //左拐
		 TIM_SetCompare1(TIM1,40000);//右轮
	   TIM_SetCompare2(TIM1,0);//左轮
		 delay_ms(200);
		 //直走
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 delay_ms(430);
		 //左拐
		 TIM_SetCompare1(TIM1,40000);//右轮
	   TIM_SetCompare2(TIM1,10000);//左轮
		 delay_ms(400);
		 //直走
		 
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 delay_ms(100);
		 //左拐
		 TIM_SetCompare1(TIM1,40000);//右轮
	   TIM_SetCompare2(TIM1,0);//左轮
		 delay_ms(200);
		 break;
	 }	  
	 	 while(1)/////直走
	 {
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 if(G6!=0)
		   break;
	 }
	 while(1)//右转
	 {
		 TIM_SetCompare1(TIM1,0);//右轮
	   TIM_SetCompare2(TIM1,25000);//左轮
		 if(G13!=0)
		 break;
	 }
	 while(1)//继续右转
	 {
		 TIM_SetCompare1(TIM1,0);//右轮
	   TIM_SetCompare2(TIM1,25000);//左轮
		 if(G13==0)
			 break;
	 }
}
	 if(i==2)
	 {
		 while(1)//拐第一个弯道
	  {
		 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 delay_ms(210);
		 TIM_SetCompare1(TIM1,32000);//右轮
	    TIM_SetCompare2(TIM1,0);//左轮
		 delay_ms(570);
		 break;
	  }
	 }	
	  while(1)//修正直走
	 {
		 if(G12 ==0 && G13!=0)//直走
		 {
			 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 }
		 if(G12!=0 && G13!=0)//向右修正
		 {
		 		TIM_SetCompare1(TIM1,15000);//右轮
	    TIM_SetCompare2(TIM1,33000);//左轮
		 }
		  if(G12==0 && G13==0)//想左修正
		 {
				TIM_SetCompare1(TIM1,32000);//右轮
	    TIM_SetCompare2(TIM1,15000);//左轮
		 }
		 if(G14==0)//出现障碍物
		 {
			 	 while(1)    //过第二个障碍物
				 {
				 //右拐
				 TIM_SetCompare1(TIM1,0);//右轮
				 TIM_SetCompare2(TIM1,40000);//左轮
				 delay_ms(450);
				 //直走
//				 TIM_SetCompare1(TIM1,31500);//右轮
//				 TIM_SetCompare2(TIM1,30000);//左轮
//				 delay_ms(25);
				 //左拐
				 TIM_SetCompare1(TIM1,40000);//右轮
				 TIM_SetCompare2(TIM1,0);//左轮
				 delay_ms(400);
				 //直走
				 TIM_SetCompare1(TIM1,31500);//右轮
				 TIM_SetCompare2(TIM1,30000);//左轮
				 delay_ms(400);
				 //左拐
				 TIM_SetCompare1(TIM1,40000);//右轮
				 TIM_SetCompare2(TIM1,0);//左轮
				 delay_ms(290);
				 break;
			 }
			 while(1)/////直走
			 {
				 TIM_SetCompare1(TIM1,31500);//右轮
				 TIM_SetCompare2(TIM1,30000);//左轮
				 if(G6!=0)
					 break;
			 }
			 while(1)//右转
			 {
				 TIM_SetCompare1(TIM1,0);//右轮
				 TIM_SetCompare2(TIM1,25000);//左轮
				 if(G13!=0)
				 break;
			 }
			 while(1)
			 {
				 TIM_SetCompare1(TIM1,0);//右轮
				 TIM_SetCompare2(TIM1,25000);//左轮
				 if(G13==0)
					 break;
			 }
		 }
		 if(G15==0)
		 {
			 break;
		 }
	 }
	 	 while(1)//拐第三个弯道
	 {
		 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 delay_ms(200);
		 TIM_SetCompare1(TIM1,32000);//右轮
	    TIM_SetCompare2(TIM1,0);//左轮
		 delay_ms(490);
		 break;
	 }
	 	while(1)
	 {
		 if(G12 ==0 && G13!=0)//直走
		 {
			 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
			 i=0;
		 }
		 if(G12!=0 && G13!=0)//向右修正
		 {
		 		TIM_SetCompare1(TIM1,15000);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
			 i=1;
		 }
		  if(G12==0 && G13==0)//想左修正
		 {
				TIM_SetCompare1(TIM1,35000);//右轮
	    TIM_SetCompare2(TIM1,15000);//左轮
			 i=2;
		 }
		 if(G15==0)
			 break;
	 }
	 while(1)
	 {
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮	
		 delay_ms(250);
		 TIM_SetCompare1(TIM1,30000);//右轮
	    TIM_SetCompare2(TIM1,0);//左轮
		 delay_ms(260);
		 break;
	 }
	 	 while(1)/////直走
	 {
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 if(G6!=0)
		   break;
	 }
	 	 	 while(1)//右转
	 {
		 TIM_SetCompare1(TIM1,0);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 if(G15==0)
		   break;
	 }	 	 
	 while(1)/////直走
	 {
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 if(G6!=0)
		   break;
	 }
	 	 while(1)/////左转
	 {
		 TIM_SetCompare1(TIM1,30000);//右轮
	   TIM_SetCompare2(TIM1,0);//左轮
		 if(G15 !=0)
		   break;
	 }
	 	 while(1)/////直走
	 {
		 TIM_SetCompare1(TIM1,31500);//右轮
	   TIM_SetCompare2(TIM1,30000);//左轮
		 if(G12!=0)///？？？？？
		   break;
	 }
	 while(1)/////直走
	 {
		 TIM_SetCompare1(TIM1,0);//右轮
	   TIM_SetCompare2(TIM1,20000);//左轮
		 if(G12==0)
		   break;
	 }
		 	while(1)
	 {
		 if(G12 ==0 && G13!=0)//直走
		 {
			 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 }
		 if(G12!=0 && G13!=0)//向右修正
		 {
		 		TIM_SetCompare1(TIM1,15000);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 }
		  if(G12==0 && G13==0)//想左修正
		 {
				TIM_SetCompare1(TIM1,35000);//右轮
	    TIM_SetCompare2(TIM1,15000);//左轮
		 }
		 if(G15==0)
			 break;
	 }
	 	 	 while(1)//拐第4个弯道
	 {
		 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 delay_ms(300);
		 TIM_SetCompare1(TIM1,32000);//右轮
	    TIM_SetCompare2(TIM1,0);//左轮
		 delay_ms(480);
		 break;
	 }
	 	while(1)
	 {
		 if(G12 ==0 && G13!=0)//直走
		 {
			 TIM_SetCompare1(TIM1,31500);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 }
		 if(G12!=0 && G13!=0)//向右修正
		 {
		 		TIM_SetCompare1(TIM1,15000);//右轮
	    TIM_SetCompare2(TIM1,35000);//左轮
		 }
		  if(G12==0 && G13==0)//想左修正
		 {
				TIM_SetCompare1(TIM1,35000);//右轮
	    TIM_SetCompare2(TIM1,15000);//左轮
		 }
	 }
 	 while(1)//停住
	 {
		 TIM_SetCompare1(TIM1,0);
	   TIM_SetCompare2(TIM1,0);
		 delay_ms(10); 
	 }
}
